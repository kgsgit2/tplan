<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë“œë˜ê·¸ ë¬¸ì œ ì¬í˜„ í…ŒìŠ¤íŠ¸</title>
    <style>
        .container {
            display: flex;
            gap: 20px;
            padding: 20px;
        }
        .sidebar {
            width: 200px;
            background: #f0f0f0;
            padding: 10px;
        }
        .timeline {
            flex: 1;
            background: #fff;
            border: 1px solid #ddd;
        }
        .slot {
            height: 60px;
            border-bottom: 1px solid #eee;
            position: relative;
        }
        .planbox {
            padding: 10px;
            margin: 5px;
            background: #4CAF50;
            color: white;
            cursor: grab;
            border-radius: 4px;
        }
        .placed-box {
            position: absolute;
            left: 0;
            right: 0;
            background: #2196F3;
            color: white;
            padding: 5px;
            cursor: grab;
            opacity: 1;
            transition: opacity 0.3s;
        }
        .placed-box.dragging {
            opacity: 0.3;
        }
        .ghost-box {
            position: absolute;
            left: 0;
            right: 0;
            background: rgba(33, 150, 243, 0.3);
            border: 2px dashed #2196F3;
            pointer-events: none;
        }
        .log {
            position: fixed;
            bottom: 10px;
            right: 10px;
            width: 300px;
            height: 200px;
            background: black;
            color: green;
            font-family: monospace;
            font-size: 12px;
            padding: 10px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar" id="sidebar">
            <h3>í”Œëœë°•ìŠ¤</h3>
            <div class="planbox" draggable="true" data-id="1">í”Œëœ 1</div>
            <div class="planbox" draggable="true" data-id="2">í”Œëœ 2</div>
        </div>
        <div class="timeline" id="timeline">
            <h3>íƒ€ì„ë¼ì¸</h3>
            <div class="slot" data-hour="9"></div>
            <div class="slot" data-hour="10"></div>
            <div class="slot" data-hour="11"></div>
            <div class="slot" data-hour="12"></div>
            <div class="slot" data-hour="13"></div>
            <div class="slot" data-hour="14"></div>
        </div>
    </div>
    <div class="log" id="log"></div>

    <script>
        let draggedElement = null;
        let draggedData = null;
        let isDraggingFromTimeline = false;
        let ghostBox = null;
        const logDiv = document.getElementById('log');
        
        function log(message) {
            const time = new Date().toISOString().split('T')[1].slice(0, 12);
            logDiv.innerHTML = `${time} ${message}<br>` + logDiv.innerHTML;
            console.log(message);
        }

        // ì‚¬ì´ë“œë°” í”Œëœë°•ìŠ¤ ë“œë˜ê·¸ ì‹œì‘
        document.querySelectorAll('.planbox').forEach(box => {
            box.addEventListener('dragstart', (e) => {
                draggedElement = e.target;
                draggedData = { id: e.target.dataset.id, text: e.target.textContent };
                isDraggingFromTimeline = false;
                e.target.style.opacity = '0.3';
                log(`ğŸŸ¢ Drag start: ${draggedData.text} from sidebar`);
            });
            
            box.addEventListener('dragend', (e) => {
                e.target.style.opacity = '1';
                cleanup();
                log(`ğŸ”´ Drag end`);
            });
        });

        // ìŠ¬ë¡¯ ì´ë²¤íŠ¸
        document.querySelectorAll('.slot').forEach(slot => {
            slot.addEventListener('dragover', (e) => {
                e.preventDefault();
                
                if (draggedData) {
                    // ê³ ìŠ¤íŠ¸ ë°•ìŠ¤ í‘œì‹œ
                    removeGhost();
                    ghostBox = document.createElement('div');
                    ghostBox.className = 'ghost-box';
                    ghostBox.style.height = '40px';
                    ghostBox.style.top = '10px';
                    ghostBox.textContent = draggedData.text;
                    slot.appendChild(ghostBox);
                    
                    log(`ğŸ“ Drag over slot ${slot.dataset.hour}`);
                }
            });
            
            slot.addEventListener('dragleave', (e) => {
                removeGhost();
            });
            
            slot.addEventListener('drop', (e) => {
                e.preventDefault();
                removeGhost();
                
                if (draggedData) {
                    // ë°•ìŠ¤ ë°°ì¹˜
                    const placedBox = document.createElement('div');
                    placedBox.className = 'placed-box';
                    placedBox.draggable = true;
                    placedBox.dataset.id = draggedData.id;
                    placedBox.textContent = draggedData.text;
                    placedBox.style.height = '40px';
                    placedBox.style.top = '10px';
                    
                    // íƒ€ì„ë¼ì¸ ë°•ìŠ¤ ì´ë²¤íŠ¸
                    placedBox.addEventListener('dragstart', (e) => {
                        e.stopPropagation(); // ì´ë²¤íŠ¸ ë²„ë¸”ë§ ë°©ì§€
                        draggedElement = e.target;
                        draggedData = { 
                            id: e.target.dataset.id, 
                            text: e.target.textContent,
                            originalSlot: slot.dataset.hour 
                        };
                        isDraggingFromTimeline = true;
                        e.target.classList.add('dragging');
                        log(`ğŸŸ¡ Drag start: ${draggedData.text} from timeline slot ${slot.dataset.hour}`);
                    });
                    
                    placedBox.addEventListener('dragend', (e) => {
                        e.target.classList.remove('dragging');
                        cleanup();
                        log(`ğŸ”´ Drag end from timeline`);
                    });
                    
                    // ë°•ìŠ¤ê°€ ìê¸° ìì‹  ìœ„ë¥¼ ì§€ë‚  ë•Œ ë¬¸ì œ ì¬í˜„
                    placedBox.addEventListener('dragover', (e) => {
                        // ì´ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ ë¬¸ì œ!
                        log(`âš ï¸ WARNING: Dragover on placed-box itself!`);
                        e.stopPropagation();
                    });
                    
                    slot.appendChild(placedBox);
                    
                    // ì‚¬ì´ë“œë°”ì—ì„œ ì œê±°
                    if (!isDraggingFromTimeline) {
                        const sidebarBox = document.querySelector(`.planbox[data-id="${draggedData.id}"]`);
                        if (sidebarBox) sidebarBox.remove();
                    } else {
                        // íƒ€ì„ë¼ì¸ì—ì„œ ì´ë™í•œ ê²½ìš° ì›ë˜ ë°•ìŠ¤ ì œê±°
                        if (draggedElement && draggedElement !== placedBox) {
                            draggedElement.remove();
                        }
                    }
                    
                    log(`âœ… Dropped in slot ${slot.dataset.hour}`);
                }
            });
        });

        function removeGhost() {
            if (ghostBox) {
                ghostBox.remove();
                ghostBox = null;
            }
        }

        function cleanup() {
            draggedElement = null;
            draggedData = null;
            isDraggingFromTimeline = false;
            removeGhost();
        }
    </script>
</body>
</html>